
(() => {
  'use strict';
  
  if (window.__viewloopMinBridgeLoaded) return;
  window.__viewloopMinBridgeLoaded = true;
  
  console.log('ðŸŒ ViewLoop Local Bridge');
  
  // Core function to get the token
  function getLocalToken() {
    return localStorage.getItem('userAuthToken');
  }
  
  // Handle messages if Chrome API is available (for compatibility)
  if (typeof chrome !== 'undefined' && chrome.runtime?.onMessage) {
    chrome.runtime.onMessage.addListener((req, sender, respond) => {
      if (req.type === 'PING') {
        respond({
          type: 'PONG',
          source: 'local_bridge',
          hasToken: !!getLocalToken(),
          timestamp: Date.now()
        });
        return true;
      }
      
      if (req.type === 'REQUEST_AUTH_TOKEN') {
        const token = getLocalToken();
        respond({
          success: !!token,
          authToken: token,
          source: 'local_bridge',
          timestamp: Date.now()
        });
        return true;
      }
      
      respond({ success: false, error: 'UNKNOWN_TYPE' });
      return true;
    });
  }
  
  console.log('âœ… Local bridge ready');
})();
