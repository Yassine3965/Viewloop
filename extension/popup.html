<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ViewLoop Monitor</title>
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div class="bg-blob"></div>
  <div class="container">

    <!-- HEADER -->
    <div class="header">
      <div class="logo-container">
        <img src="icon48.png" alt="ViewLoop" class="logo-img">
        <h1 class="app-title">ViewLoop</h1>
      </div>
      <div id="connectionStatus" class="status-badge">
        <span class="status-dot"></span>
        <span id="statusText">ุฌุงุฑู ุงูุงุชุตุงู...</span>
        <button id="refreshSyncBtn" title="ุชุฌุฏูุฏ ุงููุฒุงููุฉ"
          style="background:none; border:none; cursor:pointer; padding:0 4px; color:rgba(255,255,255,0.7);">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M23 4v6h-6"></path>
            <path d="M1 20v-6h6"></path>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- USER INFO (Hidden until loaded) -->
    <div id="userCard" class="user-card" style="display: none;">
      <img id="userAvatar" src="icon48.png" alt="Avatar" class="avatar">
      <div class="user-details">
        <h2 id="userName" class="username">ุงููุณุชุฎุฏู</h2>
        <span id="userLevel" class="user-level">ุงููุณุชูู 1</span>
      </div>
    </div>

    <!-- LOGIN PROMPT (Shown if no token) -->
    <div id="loginPrompt" class="user-card"
      style="display: flex; flex-direction: column; text-align: center; display: none;">
      <p style="font-size: 12px; color: var(--text-muted); margin: 0 0 10px;">ูู ุจุชุณุฌูู ุงูุฏุฎูู ูู ุงููููุน ูููุฒุงููุฉ</p>
      <button id="openLoginBtn" class="btn btn-primary" style="padding: 8px; font-size: 12px; margin-bottom: 8px;">ูุชุญ
        ููุญุฉ ุงูุชุญูู</button>

      <!-- Manual Fallback -->
      <details style="width: 100%; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 8px; margin-top: 8px;">
        <summary style="font-size: 10px; color: var(--text-muted); cursor: pointer;">ุฅุฏุฎุงู ุงูุฑูุฒ ูุฏููุงู</summary>
        <div style="margin-top: 8px;">
          <input type="text" id="manualTokenInput" placeholder="ุงูุตู ุฑูุฒ ุงูุงุชุตุงู ููุง"
            style="width: 100%; padding: 6px; background: rgba(0,0,0,0.2); border: 1px solid #334155; border-radius: 4px; color: white; font-size: 10px; box-sizing: border-box;">
          <button id="saveTokenBtn" class="btn btn-secondary"
            style="margin-top: 5px; padding: 6px; font-size: 10px; width: 100%;">ุงุชุตุงู</button>
        </div>
      </details>
    </div>

    <!-- STATS -->
    <div class="stats-grid">
      <div class="stat-item stat-points">
        <span class="stat-icon">๐</span>
        <span id="userPoints" class="stat-value">--</span>
        <span class="stat-label">ููุงุท</span>
      </div>
      <div class="stat-item stat-gems">
        <span class="stat-icon">๐</span>
        <span id="userGems" class="stat-value">--</span>
        <span class="stat-label">ุฌูุงูุฑ</span>
      </div>
    </div>

    <!-- PROGRESS BARS (Active Session) -->
    <div id="progressSection" class="progress-section">
      <div class="progress-label">
        <span>ุงููุฏุฉ ุงูุฃุตููุฉ: <span id="videoDurationLabel">0:00</span></span>
        <span id="progTextMain">0%</span>
      </div>
      <div class="progress-track">
        <div id="barMain" class="progress-fill"></div>
      </div>

      <div class="progress-label">
        <span>ููุช ุฅุถุงูู (ููุงูุขุช ุฃุนูู)</span>
        <span id="progTextExtra" style="color:#f59e0b">0%</span>
      </div>
      <div class="progress-track">
        <div id="barExtra" class="progress-fill extra"></div>
      </div>
    </div>

    <!-- ACTIONS -->
    <div class="actions">
      <button id="startWatchBtn" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
        ุงุจุฏุฃ ุงููุดุงูุฏุฉ
      </button>

      <button id="openDashboardBtn" class="btn btn-secondary">
        ููุญุฉ ุงูุชุญูู
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
          <polyline points="15 3 21 3 21 9"></polyline>
          <line x1="10" y1="14" x2="21" y2="3"></line>
        </svg>
      </button>
    </div>

    <div class="footer">
      Version 1.0.1 โข Running Securely
    </div>
  </div>

  <script src="popup.js"></script>
</body>

</html>